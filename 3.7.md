# 103.7 Search text files using regular expressions

1. Какое расширенное регулярное выражение будет соответствовать любому адресу электронной почты, например, info@example.org?
```sh
egrep "\S+@\S+\.\S+"
```

2. Какое расширенное регулярное выражение будет соответствовать только любому IPv4-адресу в стандартном точечно-квадратичном формате, например **192.168.15.1**?
```sh
egrep "[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}"
```

3. Как с помощью команды `grep` перечислить содержимое файла **/etc/services**, отбросив все комментарии (строки, начинающиеся с `#`)?
```
grep -v ^# /etc/services
```

4. Файл **domains.txt** содержит список доменных имен, по одному в строке. Как можно использовать команду `egrep`, чтобы перечислить только домены **.org** или **.com**?
```sh
egrep ".org$|.com$" domains.txt
```

5. Как в команде `find` с помощью расширенного регулярного выражения найти в текущем каталоге все файлы, не содержащие стандартного суффикса (например, имена файлов, не заканчивающиеся на **.txt** или **.c**)?
```sh
find . -type f -regextype egrep -not -regex '.*\.[[:alnum:]]{1,}$'
```

6. Команда `less` является стандартным пагинатором для отображения длинных текстовых файлов в среде shell. Набрав `/`, можно ввести регулярное выражение в строку поиска для перехода к первому соответствующему совпадению. Чтобы остаться в текущей позиции документа и выделять только соответствующие совпадения, какую комбинацию клавиш следует ввести в строке поиска?

Нажатие клавиш `Ctrl + K` перед вводом поискового выражения.

7. В меньшей степени, как можно отфильтровать вывод, чтобы отображались только строки, соответствующие регулярному выражению?

Нажав клавишу `&` и введя поисковое выражение.

8. Команда `last` выводит список последних вошедших в систему пользователей, включая их исходные IP-адреса. Как можно использовать команду `egrep` для фильтрации вывода `last`, показывая только вхождения IPv4-адреса и отбрасывая всю дополнительную информацию в соответствующей строке?

```sh
last -i | egrep -o '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}'
```

9. Какую опцию следует задать для `grep`, чтобы правильно отфильтровать вывод, полученный командой `find`, выполненной с опцией `-print0`?

Опция `-z` или `--null-data`, как в выражении `find . -print0 | grep -z`.

10.  Команда `uptime -s` показывает последнюю дату, когда система была включена, например **2019-08-05 20:13:22**. Каков будет результат выполнения команды `uptime -s | sed -e 's/(.*) (.*)/\1/'`?

Возникнет ошибка. По умолчанию, чтобы использовать обратные ссылки в `sed`, скобки должны быть экранированы.

11.  Какую опцию следует задать для `grep`, чтобы он подсчитывал совпадающие строки, а не выводил их на экран?

Опция `-c`.

12. Базовая структура HTML-файла начинается, например, с элементов **html**, **head** и **body**:
```html
<html>
    <head>
        <title>News Site</title>
    </head>
        <body>
            <h1>Headline</h1>
            <p>Information of interest.</p>
        </body>
</html>
```
Опишите, как в `sed` можно использовать адреса для отображения только элемента **body** и его содержимого.

Чтобы показать только тело, адреса должны быть `/<body>/,/<\/body>/`, как в `sed -n -e '/<body>/,/<\/body>/p'`. Опция `-n` дана `sed` для того, чтобы он по умолчанию не печатал строки, поэтому в конце выражения `sed` есть команда `p` для печати совпадающих строк.

13. Какое выражение `sed` удалит все теги из HTML-документа, сохранив только отображаемый текст?

Выражение `sed s/<[^>]*>//g` заменит любое содержимое, заключенное в `<>`, на пустую строку.

14. Файлы с расширением **.ovpn** очень популярны для настройки VPN-клиентов, поскольку содержат не только настройки, но и содержимое ключей и сертификатов для клиента. Изначально эти ключи и сертификаты находятся в отдельных файлах, поэтому их необходимо скопировать в файл **.ovpn**. Приведенный ниже фрагмент шаблона **.ovpn**:
```html
client
dev tun
remote 192.168.1.155 1194
<ca>
    ca.crt
</ca>
<cert>
    client.crt
</cert>
<key>
    client.key
</key>
<tls-auth>
    ta.key
</tls-auth>
```

Если предположить, что файлы **ca.crt**, **client.crt**, **client.key** и **ta.key** находятся в текущем каталоге, то каким образом конфигурация шаблона будет изменена с помощью `sed`, чтобы заменить имя каждого файла на его содержимое?
Комманда
```sh
sed -r -e 's/(^[^.]*)\.(crt|key)$/cat \1.\2/e' < client.template > client.ovpn 
```
заменяет любую строку, заканчивающуюся на **.crt** или **.key**, содержимым файла, имя которого равно этой строке. Опция `-r` указывает `sed` на использование расширенных регулярных выражений, а нe в конце выражения указывает `sed` на замену совпадений выводом команды `cat \1.\2`. Обратные ссылки `\1` и `\2` соответствуют имени и расширению файла, найденного в совпадении.
