# 104.2 Maintain the integrity of filesystems

1. Как с помощью программы `du` проверить, сколько места занимают только файлы в текущем каталоге?

Сначала с помощью параметра `-S` отделите вывод текущего каталога от его подкаталогов. Затем используйте параметр `-d 0`, чтобы ограничить глубину вывода нулем, то есть "без подкаталогов".
Не забывайте о параметре `-h` для получения вывода в "человекочитаемом" формате:
```sh
du -S -h -d 0
```
или
```sh
du -Shd 0
```

2. С помощью `df` можно вывести список информации для каждой файловой системы ext4, в котором будут указаны следующие поля по порядку: устройство, точка монтирования, общее количество инодов, количество доступных инодов, процент свободного места.

Отфильтровать файловые системы можно с помощью опции `-t`, за которой следует имя файловой системы. Чтобы получить нужный вывод, используйте `--output=source`,target,itotal,iavail,pcent. Итак, ответ:
```sh
df -t ext4 --output=source,target,itotal,iavail,pcent
```

3. Какой командой можно запустить `e2fsck` на **/dev/sdc1** в неинтерактивном режиме с автоматическим исправлением большинства ошибок?

Параметром для автоматического исправления большинства ошибок является `-p`. Поэтому ответ следующий:
```sh
e2fsck -p /dev/sdc1
```

4. Предположим, что диск **/dev/sdb1** является файловой системой **ext2**. Как преобразовать ее в **ext3**, сбросив при этом счетчик монтирования и изменив метку на **UserData**?

Помните, что преобразование файловой системы **ext2** в **ext3** сводится к добавлению журнала, что можно сделать с помощью параметра `-j`. Чтобы сбросить счетчик монтирования, используйте параметр `-C 0`. Чтобы изменить метку используйте параметр `-L UserData`. Правильный ответ:
```sh
tune2fs -j -C 0 -L UserData /dev/sdb1
```

5. Как проверить наличие ошибок в файловой системе XFS, не исправляя найденные повреждения?

Используйте параметр `-n`, как в `xfs -n`, после которого указывается соответствующее устройство.

6. Предположим, что у вас есть файловая система ext4 на **/dev/sda1** со следующими параметрами, полученными с помощью `tune2fs`:
```console
Mount count: 8
```
Максимальное количество монтирований: -1
Что произойдет при следующей загрузке, если будет выполнена команда `tune2fs -c 9 /dev/sda1`?

Команда установит максимальное число монтирований для файловой системы равным 9. Поскольку в настоящее время число монтирований равно 8, при следующей загрузке системы будет произведена проверка файловой системы.

7. Рассмотрим следующий вывод программы `du -h`:
```sh
$ du -h
216K ./somedir/anotherdir
224K ./somedir
232K .
```
Сколько места занимают только файлы в текущем каталоге? Как можно переписать команду, чтобы показать эту информацию более наглядно?

Из общего количества используемых 232К, 224К занято подкаталогом **somedir** и его подкаталогами.
Таким образом, исключая их, мы имеем 8К, занятых файлами в текущем каталоге. Более наглядно эту информацию можно показать с помощью параметра `-S`, который разделит каталоги при подсчете.

8. Что произойдет с файловой системой ext2 **/dev/sdb1** при выполнении следующей команды?
```sh
tune2fs -j /dev/sdb1 -J device=/dev/sdc1 -i 30d
```

В файловую систему **/dev/sdb1** будет добавлен журнал, преобразующий ее в формат ext3. Журнал будет храниться на устройстве **/dev/sdc1**, а файловая система будет проверяться каждые 30 дней.

9. Как проверить наличие ошибок в файловой системе XFS на **/dev/sda1**, которая имеет раздел журнала на **/dev/sdc1**, не производя при этом никаких восстановлений?

Используйте` xfs_repair`, затем `-l /dev/sdc1`, чтобы указать устройство, содержащее раздел журнала, и `-n`, чтобы не вносить никаких изменений.
```sh
xfs_repair -l /dev/sdc1 -n
```

10. В чем разница между параметрами `-T` и `-t` для `df`?

Параметр `-T` включает в вывод `df` тип каждой файловой системы. Параметр `-t` является фильтром и на выходе будут показаны только файловые системы заданного типа, исключая все остальные.