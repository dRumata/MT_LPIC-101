## Практическая работа 17. 
## Поддержка целостности файловых систем.

> Соответствие LPI101: (104.2 Maintain the integrity of filesystems)

### Вопросы для самопроверки

1. Какой командой можно запустить `e2fsck` на **/dev/sdc1** в неинтерактивном режиме с автоматическим исправлением большинства ошибок?
    <details>
    <summary>Вариант ответа</summary>

    Параметром для автоматического исправления большинства ошибок является `-p`. Поэтому ответ следующий:
    ```sh
    e2fsck -p /dev/sdc1
    ```
    
    </details>
<br> 
   


2. Предположим, что диск **/dev/sdb1** является файловой системой **ext2**. Как преобразовать ее в **ext3**, сбросив при этом счетчик монтирования и изменив метку на **UserData**?
    <details>
    <summary>Вариант ответа</summary>

    Помните, что преобразование файловой системы **ext2** в **ext3** сводится к добавлению журнала, что можно сделать с помощью параметра `-j`. Чтобы сбросить счетчик монтирования, используйте параметр `-C 0`. Чтобы изменить метку используйте параметр `-L UserData`. Правильный ответ:
    
    ```sh
    tune2fs -j -C 0 -L UserData /dev/sdb1
    ```
    
    </details>
<br> 
   

3. Как проверить наличие ошибок в файловой системе XFS, не исправляя найденные повреждения?
    <details>
    <summary>Вариант ответа</summary>

    Используйте параметр `-n`, как в `xfs -n`, после которого указывается соответствующее устройство.
    
    </details>
<br> 
   



4. Предположим, что у вас есть файловая система ext4 на **/dev/sda2** со следующими параметрами, полученными с помощью `tune2fs`:

```console
Mount count:                8
Maximum mount count:       -1
```

Максимальное количество монтирований: -1

Что произойдет при следующей загрузке, если будет выполнена команда `tune2fs -c 9 /dev/sda1`?

<details>
<summary>Вариант ответа</summary>

Команда установит максимальное число монтирований для файловой системы равным 9. Поскольку в настоящее время число монтирований равно 8, при следующей загрузке системы будет произведена проверка файловой системы.
    
</details>
<br> 
   

5. Рассмотрим следующий вывод программы `du -h`:
```sh
$ du -h
216K ./somedir/anotherdir
224K ./somedir
232K .
```
Сколько места занимают только файлы в текущем каталоге? Как можно переписать команду, чтобы показать эту информацию более наглядно?

<details>
<summary>Вариант ответа</summary>

Из общего количества используемых 232К, 224К занято подкаталогом **somedir** и его подкаталогами.
Таким образом, исключая их, мы имеем 8К, занятых файлами в текущем каталоге. Более наглядно эту информацию можно показать с помощью параметра `-S`, который разделит каталоги при подсчете.
    
</details>
<br> 

6. Что произойдет с файловой системой ext2 **/dev/sdb1** при выполнении следующей команды?
   
```sh
tune2fs -j /dev/sdb1 -J device=/dev/sdc1 -i 30d
```
 <details>
    <summary>Вариант ответа</summary>

В файловую систему **/dev/sdb1** будет добавлен журнал, преобразующий ее в формат ext3. Журнал будет храниться на устройстве **/dev/sdc1**, а файловая система будет проверяться каждые 30 дней.
    
</details>
<br> 
   
7.  В чем разница между параметрами `-T` и `-t` для `df`?
    <details>
    <summary>Вариант ответа</summary>

    Параметр `-T` включает в вывод `df` тип каждой файловой системы. Параметр `-t` является фильтром и на выходе будут показаны только файловые системы заданного типа, исключая все остальные.
    
    </details>
<br> 
   


---
### Практические задания
1. С помощью программы `du` проверьте, сколько места занимают только файлы в текущем каталоге?

1.1 Сначала с помощью параметра `-S` отделите вывод текущего каталога от его подкаталогов. Затем используйте параметр `-d 0`, чтобы ограничить глубину вывода нулем, то есть "без подкаталогов".
Не забывайте о параметре `-h` для получения вывода в "человекочитаемом" формате:
```sh
du -S -h -d 0
```
или
```sh
du -Shd 0
```

---
2. С помощью `df` можно вывести список информации для каждой файловой системы ext4, в котором будут указаны следующие поля по порядку: устройство, точка монтирования, общее количество инодов, количество доступных инодов, процент свободного места.

2.1 Отфильтруйте файловые системы можно с помощью опции `-t`, за которой следует имя файловой системы. Чтобы получить нужный вывод, используйте `--output=source`,target,itotal,iavail,pcent. 

```sh
df -t ext4 --output=source,target,itotal,iavail,pcent
```

---
3. Проверьте наличие ошибок в файловой системе XFS на **/dev/sda2**, не производя при этом никаких восстановлений?

```sh
xfs_repair /dev/sda2 -n
```
1.2 Команда завершилась ошибкой. Отмонтируйте /dev/sda2  и повторите предыдущий шаг.

```sh
umount /dev/sda2
xfs_repair /dev/sda2 -n
```