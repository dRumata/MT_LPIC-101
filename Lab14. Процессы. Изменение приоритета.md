## Практическая работа 14. 
## Загрузка системы.

# 3. Команды GNU и UNIX

## 3.6 Процессы. Изменение приоритета.  (103.6 Modify process execution priorities)

### Вопросы для самопроверки
1. Что происходит в вытесняющей многозадачной системе, когда процессор занимает процесс с более низким приоритетом, а в очереди на выполнение стоит процесс с более высоким приоритетом?

    <details>
    <summary>Вариант ответа</summary>

    Процесс с более низким приоритетом приостанавливается, и вместо него выполняется процесс с более высоким приоритетом.
    
    </details>
<br> 


2. Рассмотрим следующий верхний экран:

```console
top - 08:43:14 up 23 days, 12:29, 5 users, load average: 0,13, 0,18, 0,21
Tasks: 240 total, 2 running, 238 sleeping, 0 stopped, 0 zombie
%Cpu(s): 1,4 us, 0,4 sy, 0,0 ni, 98,1 id, 0,0 wa, 0,0 hi, 0,0 si, 0,0 st
MiB Mem : 7726,4 total, 590,9 free, 1600,8 used, 5534,7 buff/cache
MiB Swap: 30517,0 total, 30462,5 free, 54,5 used. 5769,4 avail Mem
PID USER PR NI VIRT RES SHR S %CPU %MEM TIME+ COMMAND
1 root 20 0 171420 10668 7612 S 0,0 0,1 9:59.15 systemd
2 root 20 0 0 0 0 S 0,0 0,0 0:02.76 kthreadd
3 root 0 -20 0 0 0 I 0,0 0,0 0:00.00 rcu_gp
4 root 0 -20 0 0 0 I 0,0 0,0 0:00.00 rcu_par_gp
8 root 0 -20 0 0 0 I 0,0 0,0 0:00.00 mm_percpu_wq
9 root 20 0 0 0 0 S 0,0 0,0 0:49.06 ksoftirqd/0
10 root 20 0 0 0 0 I 0,0 0,0 18:24.20 rcu_sched
11 root 20 0 0 0 0 I 0,0 0,0 0:00.00 rcu_bh
12 root rt 0 0 0 0 S 0,0 0,0 0:08.17 migration/0
14 root 20 0 0 0 0 S 0,0 0,0 0:00.00 cpuhp/0
15 root 20 0 0 0 0 S 0,0 0,0 0:00.00 cpuhp/1
16 root rt 0 0 0 0 S 0,0 0,0 0:11.79 migration/1
17 root 20 0 0 0 0 S 0,0 0,0 0:26.01 ksoftirqd/1
```
Какие PID имеют приоритеты реального времени?

<details>
    <summary>Вариант ответа</summary>

    PIDs 12 и 16.
    
</details>
<br> 


3. Рассмотрим следующий листинг` ps -el`:
```console
F S UID PID PPID C PRI NI ADDR SZ WCHAN TTY TIME CMD
4 S 0 1 0 0 80 0 - 42855 - ? 00:09:59 systemd
1 S 0 2 0 0 80 0 - 0 - ? 00:00:02 kthreadd
1 I 0 3 2 0 60 -20 - 0 - ? 00:00:00 rcu_gp
1 S 0 9 2 0 80 0 - 0 - ? 00:00:49 ksoftirqd/0
1 I 0 10 2 0 80 0 - 0 - ? 00:18:26 rcu_sched
1 I 0 11 2 0 80 0 - 0 - ? 00:00:00 rcu_bh
1 S 0 12 2 0 -40 - - 0 - ? 00:00:08 migration/0
1 S 0 14 2 0 80 0 - 0 - ? 00:00:00 cpuhp/0
5 S 0 15 2 0 80 0 - 0 - ? 00:00:00 cpuhp/1
```
Какой из PID имеет более высокий приоритет?

<details>
    <summary>Вариант ответа</summary>

    PID 12
    
</details>
<br> 



---
### Практические задания

1. При попытке изменить процесс с помощью `renice` возникает ошибка:
1.1 Создайте процесс
```sh
tail -f .bash_history >newfile &
```
1.2 Узнайте ID процесса для следующего шага
```sh
pgrep tail
```
1.3 Измените процесс
```sh
renice -10 ID_из_шага_1.2
```

```
renice: failed to set priority for 21704 (process ID): Permission denied
```

1.4 Только пользователь **root** может уменьшать `renice` ниже нуля. Повторите предыдущий шаг с повышением привелегий.

---
2. Изменение приоритетов процессов обычно требуется, когда какой-либо процесс занимает слишком много процессорного времени. 

2.1 Отсортитруйте процессы по использованию процессора в порядке возрастания при использовании `ps` со стандартными опциями для печати всех системных процессов в длинном формате, используйте флаг `--sort`

```sh
ps -el --sort=pcpu
```

---
3. Команда `schedtool` позволяет задать все параметры планирования процессора, на которые способен Linux, или вывести информацию для заданных процессов. 

3.1 Создайте процесс
```sh
tail -f .bash_history >newfile &
```
3.2 Узнайте ID процесса для следующего шага
```sh
pgrep tail
```
3.3 Отобразите параметры планирования процесса **ID_Шаг_3.2** 

```sh
schedtool ID_Шаг_3.2
```

3.4 Кроме того, как с помощью `schedtool` можно перевести процесс **ID_Шаг_3.2** в режим реального времени с приоритетом **-90** (как показано сверху)?

```sh
schedtool -R -p 89 ID_Шаг_3.2
```