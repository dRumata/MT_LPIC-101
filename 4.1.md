# 104.1 Create partitions and filesystems

1. Какую схему разметки следует использовать для разбиения жесткого диска объемом 3 ТБ на три раздела по 1 ГБ? Почему?

GPT, поскольку MBR поддерживает не более 2 ТБ жестких дисков.

2. Как в программе `gdisk` узнать, сколько места доступно на диске?

С помощью команды `p` (print). Общее количество свободного места будет показано в последней строке информации перед самой таблицей разделов.

3. Какой командой можно создать на устройстве **/dev/sdc1** файловую систему **ext3** с меткой **MyDisk** и случайным **UUID**, предварительно проверив ее на наличие поврежденных блоков?

Команда будет выглядеть так: 
```sh
mkfs.ext3 -c -L MyDisk -U random /dev/sdc1
```
Также вместо `mkfs.ext3` можно использовать команду 
```sh
mke2fs -t ext3
```

4. Используя `parted`, какой командой можно создать раздел **ext4** размером 300 МБ, начиная с 500 МБ на диске?

Используйте команду 
```sh
mkpart primary ext4 500m 800m
``` 
Помните, что файловую систему придется создавать с помощью **mkfs.ext4**, поскольку parted этого не делает.

5. Представьте, что у вас есть 2 раздела, один на **/dev/sda1**, другой на **/dev/sdb1**, оба размером 20 ГБ. Как их использовать в одной файловой системе **Btrfs** таким образом, чтобы содержимое одного раздела автоматически зеркалировалось на другом, как в **RAID1**? Какого размера будет файловая система?

Используйте команду 
```sh
mkfs.btrfs /dev/sda1 /dev/sdb1 -m raid1
```
Результирующая файловая система будет иметь размер 20 ГБ, так как один раздел является просто зеркальным отображением другого.

6. Рассмотрим диск объемом 2 Гбайт с таблицей разделов MBR и следующей разметкой:
```console
Disk /dev/sdb: 1.9 GiB, 1998631936 bytes, 3903578 sectors
Disk model: DataTraveler 2.0
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: dos
Disk identifier: 0x31a83a48
Device Boot Start End Sectors Size Id Type
/dev/sdb1 2048 1050623 1048576 512M 83 Linux
/dev/sdb3 2099200 3147775 1048576 512M 83 Linux
```
Можно ли создать на нем раздел размером 600 МБ? Почему?

Невозможно, поскольку не хватает свободного места. Первым признаком того, что что-то "не так", является список устройств: у вас есть **/dev/sdb1** и **/dev/sdb3**, но нет **/dev/sdb2**. Значит, чего-то не хватает. Затем нужно посмотреть, где заканчивается один раздел и начинается другой. Первый раздел заканчивается на секторе 1050623, а второй начинается на 2099200. Таким образом, "разрыв" составляет 1048577 секторов. При 512 байтах на сектор это составляет 536.871.424 байта. Если разделить это на 1024, то получится 524,288 килобайта. Снова делим на 1024 и получаем... 512 МБ. Это и есть размер "зазора".
Если диск имеет объем 2 Гбайт, то после раздела 3 мы получим максимум еще на 512 Мбайт. Даже если в общей сложности у нас нераспределено около 1 ГБ, самый большой смежный блок составляет 512 МБ. Значит, для раздела размером 600 Мбайт места нет.

7. На диске по адресу **/dev/sdc** имеется первый раздел размером 1 ГБ, содержащий файловую систему **ext4** с файлами размером 241 МБ. Как с помощью `parted` уменьшить этот раздел, чтобы на нем осталось достаточно места для файлов?

Эта операция состоит из нескольких частей. Сначала нужно уменьшить файловую систему с помощью `resize2fs`. Вместо того чтобы указывать новый размер напрямую, можно использовать параметр `-M`, чтобы он был просто "достаточно большим". Итак:
```sh
resize2fs -M /dev/sdc1
```
Затем с помощью `resizepart` изменяем размер самого раздела с помощью `parted`. Поскольку это первый раздел, можно считать, что он начинается с нуля и заканчивается 241 МБ. Поэтому команда выглядит следующим образом 
```sh
resizepart 1 241M
```

3. Представьте, что у вас есть диск по адресу **/dev/sdb**, и вы хотите создать в его начале раздел размером 1 ГБ. Поэтому, используя `parted`, вы создаете раздел с помощью команды `mkpart primary linux-swap 0 1024M`. Затем с помощью команды `swapon /dev/sdb1` вы включаете своп на этом разделе, но получаете следующее сообщение об ошибке:
```console
swapon: /dev/sdb1: read swap header failed
```
Что произошло?

Вы создали раздел правильного типа (linux-swap), но помните, что `mkpart` не создает файловую систему. Вы забыли установить раздел в качестве пространства подкачки с помощью mkswap, прежде чем использовать его.

4. В ходе этого урока вы отрабатывали некоторые команды в `parted`, но по ошибке удалили 3-й раздел жесткого диска. Вы знаете, что он располагался после раздела EFI размером 250 МБ и раздела подкачки размером 4 ГБ и имел размер 10 ГБ. Какую команду `parted` можно использовать для его восстановления?

Не паникуйте, у вас есть вся необходимая информация для восстановления раздела, просто используйте команду `rescue` и посчитайте. Перед ним было 250 МБ + 4.096 МБ (4 * 1024), поэтому начальная точка должна быть около 4346 МБ. Плюс 10,240 МБ (10*1024), в итоге должно получиться 14,586 МБ. Таким образом, для спасения 4346m 14586m должно хватить. В зависимости от геометрии диска, возможно, придется дать некоторый "люфт" для `rescue`, начав немного раньше и закончив немного позже.

5. Представьте, что на диске **/dev/sda3** имеется неиспользуемый раздел размером 4 ГБ. Какова будет последовательность действий при использовании `fdisk` для превращения его в активный раздел подкачки?

Сначала измените тип раздела на **"Linux Swap" (82)**, запишите изменения на диск и выйдите из системы. Затем с помощью `mkswap` установите раздел в качестве области подкачки. Затем с помощью `swapon` включите его.