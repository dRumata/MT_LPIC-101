# 104.5 Manage file permissions and ownership

1. Создайте каталог с именем **emptydir** с помощью команды `mkdir emptydir`. Теперь, используя команду `ls`, выведите список разрешений для каталога **emptydir**.
Добавьте в команду `ls` параметр `-d`, чтобы увидеть атрибуты файлов каталога, а не его содержимое. Итак, ответ:
```sh
ls -l -d emptydir
```
Бонусные очки, если вы объединили два параметра в один, как в 
```sh
ls -ld emptydir
```

2. Создайте пустой файл с именем **emptyfile** командой `touch emptyfile`. Теперь, используя `chmod` в символьном режиме, добавьте права на выполнение для владельца файла **emptyfile** и снимите права на запись и выполнение для всех остальных. Для этого используется только одна команда `chmod`.

Подумайте об этом следующим образом:
- "Для пользователя, владеющего файлом `u`, добавить `+` права на выполнение `x`", поэтому `u+x`.
- "Для группы `g` и других пользователей `o` снимите `-` разрешения на запись `w` и выполнение `x`", так что `go-wx`.
Чтобы объединить эти два набора разрешений, мы добавляем между ними запятую. Таким образом, итоговый результат таков:
```sh
chmod u+x,go-wx emptyfile
```

3. Какими будут разрешения по умолчанию для файла, если значение **umask** установлено в **027**?

Разрешения будут **rw-r-----**

4. Предположим, что файл с именем **test.sh** является сценарием оболочки со следующими правами доступа и владения:
```console
-rwxr-sr-x 1 carol root 33 Dec 11 10:36 test.sh
```
- Каковы права доступа для владельца файла?
Разрешения для владельца (2-4-й символы в выводе `ls -l`) - **rwx**, поэтому ответ: "читать, записывать и исполнять файл".
- Используя восьмеричную нотацию, каким должен быть синтаксис команды `chmod`, чтобы "снять" специальное разрешение, предоставленное этому файлу?
Мы можем "снять" специальные разрешения, передав в команду `chmod` 4-ю цифру, **0**. Текущие разрешения равны **755**, поэтому команда должна быть 
```sh
chmod 0755
```

5. Рассмотрим этот файл:
```sh
$ ls -l /dev/sdb1
brw-rw---- 1 root disk 8, 17 Dec 21 18:51 /dev/sdb1
```
К какому типу относится файл **sdb1**? Кто может производить в него запись?

Первый символ в выводе `ls -l` показывает тип файла. `b` - блочное устройство, обычно диск (внутренний или внешний), подключенный к машине. На него могут писать владелец (**root**) и все пользователи группы **disk**.

6. Рассмотрим следующие 4 файла:
```console
drwxr-xr-t 2 carol carol 4,0K Dec 20 18:46 Another_Directory
----r--r-- 1 carol carol 0 Dec 11 10:55 foo.bar
-rw-rw-r-- 1 carol carol 1,2G Dec 20 18:22 HugeFile.zip
drwxr-sr-x 2 carol users 4,0K Jan 18 17:26 Sample_Directory
```
Запишите соответствующие разрешения для каждого файла и каталога в восьмеричном режиме с использованием 4-значной нотации.

Соответствующие разрешения в восьмеричном виде выглядят следующим образом:
```
Another_Directory 1755
``` 

**1** - sticky bit, **755** - обычные разрешения (**rwx** для пользователя, **r-x** для группы и других).

```
foo.bar 0044
```
Отсутствуют специальные разрешения (поэтому первая цифра равна **0**), отсутствие разрешений для пользователя (**---**) и только чтение (**r-r--**) для группы и других.

```
HugeFile.zip 0664
```
Специальных прав нет, поэтому первая цифра равна **0**. **6** (**rw-**) для пользователя и группы, **4** (**r--**) для остальных.

```
Sample_Directory 2755
``` 
**2** - для бита **SGID**, **7** (**rwx**) - для пользователя, **5** (**r-x**) - для группы и другие.

7. Попробуйте сделать это в терминале: создайте пустой файл с именем **emptyfile** командой `touch emptyfile`. Теперь "обнулите" права доступа к файлу командой `chmod 000 emptyfile`. Что произойдет, если изменить права на **emptyfile**, передав только одно значение для `chmod` в восьмеричном режиме, например `chmod 4 emptyfile`? А если использовать два, как в `chmod 44 emptyfile`? Что мы можем узнать о том, как chmod считывает числовое значение?
Вспомните, что мы "обнулили" права доступа для **emptyfile**. Таким образом, его начальное состояние будет таким:

```console
---------- 1 carol carol 0 Dec 11 10:55 emptyfile
```

Теперь попробуем выполнить первую команду, `chmod 4 emptyfile`:

```sh
chmod 4 emptyfile
ls -l emptyfile

-------r-- 1 carol carol 0 Dec 11 10:55 emptyfile
```

См. Разрешения для других были изменены. А что, если мы попробуем ввести две цифры, как в `chmod 44 emptyfile`?
```sh
$ chmod 44 emptyfile
$ ls -l emptyfile
----r--r-- 1 carol carol 0 Dec 11 10:55 emptyfile
```

Теперь были изменены права доступа для **group** и **others**. Из этого можно сделать вывод, что в восьмеричном режиме `chmod` считывает значение "задом наперед", от младшего разряда **others** к старшему **user**. Если передается одна цифра, то изменяются права для **others**. При передаче двух цифр изменяется **group** и **others**, при передаче трех - **user**, **group** и **others**, а при передаче четырех цифр - **user**, **group**, **others** и **специальные разрешения**.

8. Рассмотрим права доступа к временному каталогу **/tmp** в системе Linux:

```sh
$ ls -l /tmp
drwxrwxrwt 19 root root 16K Dec 21 18:58 tmp
```
**user**, **group** и **others** имеют полные права. Но может ли обычный пользователь удалить какие-либо файлы из этого каталога? Почему так происходит?


Каталог **/tmp** является каталогом с возможностью записи, то есть любой пользователь может писать в него. Но мы не хотим, чтобы один пользователь вмешивался в файлы, созданные другими, поэтому в каталоге установлен "липкий" бит (на что указывает буква `t` в разрешении для других). Это означает, что пользователь может удалять файлы в каталоге **/tmp**, но только те, которые созданы им самим.

9. Файл с именем **test.sh** имеет следующие разрешения: `-rwsr-xr-x`, то есть установлен бит **SUID**.
Теперь выполните следующие команды:
```sh
$ chmod u-x test.sh
$ ls -l test.sh
-rwSr-xr-x 1 carol carol 33 Dec 11 10:36 test.sh
```
Что мы сделали? Что означает заглавная буква `S`?

Мы удалили права на выполнение для пользователя, которому принадлежит файл. Символ `s` (или `t`) занимает место символа `x` в выводе команды `ls -l`, поэтому системе нужно как-то показать, есть ли у пользователя права на выполнение или нет. Для этого нужно изменить регистр специального символа.
Строчная буква `s` в первой группе разрешений означает, что пользователь, которому принадлежит файл, имеет права на выполнение и что установлен бит **SUID**. Прописная `S` означает, что пользователь, владеющий файлом, не имеет `-` прав на выполнение и бит **SUID** установлен.
То же самое можно сказать и о **SGID**: строчная буква `s` во второй группе разрешений означает, что группа, которой принадлежит файл, имеет права на выполнение и что бит **SGID** установлен. Прописная S означает, что группа, владеющая файлом, не имеет `-` прав на выполнение и бит **SGID** установлен.
Это также справедливо и для бита **sticky**, представленного буквой `t` в третьей группе разрешений. Строчная буква `t` означает, что липкий бит установлен и что другие имеют права на выполнение. Прописная `T` означает, что липкий бит установлен и что у других нет прав на выполнение.

10. Как создать каталог с именем **Box**, в котором все файлы автоматически принадлежат группе **users** и могут быть удалены только создавшим их пользователем?

Это многоэтапный процесс. Первый шаг - создание каталога:
```sh
$ mkdir Box
```
Мы хотим, чтобы каждый файл, созданный в этом каталоге, автоматически присваивался группе **users**. Мы можем сделать это, установив данную группу в качестве владельца каталога, а затем установив для нее бит **SGID**. Нам также необходимо убедиться, что любой член группы может писать в этот каталог.
Поскольку нам не важны другие права доступа, а мы хотим "перекинуть" только специальные биты, имеет смысл использовать символьный режим:
```sh
$ chown :users Box/
$ chmod g+wxs Box/
```
Обратите внимание, что если ваш текущий пользователь не входит в группу **users**, то для выполнения изменений от имени **root** перед приведенными выше командами необходимо использовать команду sudo.
Теперь последняя часть: необходимо убедиться, что только пользователь, создавший файл, может его удалить. Это делается путем установки "липкого" бита (обозначается буквой `t`) на каталог. Помните, что он установлен на разрешениях для других `o`.
```sh 
$ chmod o+t Box/
```
Разрешения на каталог **Box** должны быть следующими:
```console
drwxrwsr-t 2 carol users 4,0K Jan 18 19:09 Box
```
Конечно, можно указать **SGID** и **sticky**-бит, используя только одну команду `chmod`:
```sh
$ chmod g+wxs,o+t Box/
```
Бонусные очки, если вы додумались до этого.
